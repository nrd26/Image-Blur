{"version":3,"file":"index.js","names":["throwError","ensureInteger","getAddonReleaseVersion","cppCallbackWrapper","wrapAsync","addon","require","RESIZE_METHOD_MAP","nearestNeighbor","nearestNeighbour","bilinearInterpolation","bicubicInterpolation","hermiteInterpolation","bezierInterpolation","defaultInterpolation","resize","width","height","mode","cb","constructor","AUTO","bitmap","call","modeNumber","targetBitmapData","Buffer","alloc","originalBitmap","data","originalWidth","originalHeight","err","plugin","constants","RESIZE_NEAREST_NEIGHBOR","RESIZE_BILINEAR","RESIZE_BICUBIC","RESIZE_HERMITE","RESIZE_BEZIER","resizeAsync"],"sources":["../src/index.ts"],"sourcesContent":["import { throwError } from \"@jimp/utils\";\nimport { Resize } from \"@jimp/plugin-resize\";\nimport { ImageCallback } from \"@jimp/core\";\nimport {\n  ensureInteger,\n  getAddonReleaseVersion,\n  cppCallbackWrapper,\n  AsyncPlugin,\n  wrapAsync,\n} from \"@jimp-native/utils-ts\";\n\nconst addon = require(`../build/${getAddonReleaseVersion()}/plugin-resize-napi.node`);\n\ntype PluginResize = AsyncPlugin<Resize[\"class\"]>;\n\nconst RESIZE_METHOD_MAP = {\n  nearestNeighbor: 0,\n  nearestNeighbour: 0,\n  bilinearInterpolation: 1,\n  bicubicInterpolation: 2,\n  hermiteInterpolation: 3,\n  bezierInterpolation: 4,\n  defaultInterpolation: 99,\n} as const;\n\ntype ResizeMethod = keyof typeof RESIZE_METHOD_MAP;\n\nfunction resize(\n  width: number,\n  height: number,\n  mode:\n    | ResizeMethod\n    | string\n    | ImageCallback<PluginResize> = \"defaultInterpolation\",\n  cb?: ImageCallback<PluginResize>\n) {\n  if (typeof mode === \"function\" && typeof cb === \"undefined\") {\n    cb = mode;\n    mode = \"defaultInterpolation\";\n  }\n\n  if (width === this.constructor.AUTO) {\n    width = this.bitmap.width * (height / this.bitmap.height);\n  }\n\n  if (height === this.constructor.AUTO) {\n    height = this.bitmap.height * (width / this.bitmap.width);\n  }\n\n  if (width <= 0) {\n    return throwError.call(this, \"Width must be greater than zero\", cb);\n  }\n\n  if (height <= 0) {\n    return throwError.call(this, \"Height must be greater than zero\", cb);\n  }\n\n  let modeNumber = RESIZE_METHOD_MAP[mode as string];\n\n  if (typeof modeNumber !== \"number\") {\n    modeNumber = 99;\n  }\n\n  width = ensureInteger(width);\n  height = ensureInteger(height);\n  const targetBitmapData = Buffer.alloc(width * height * 4);\n\n  try {\n    const originalBitmap = this.bitmap.data;\n    const originalWidth = this.bitmap.width;\n    const originalHeight = this.bitmap.height;\n\n    this.bitmap.data = targetBitmapData;\n    this.bitmap.width = width;\n    this.bitmap.height = height;\n\n    addon.resize(\n      originalBitmap,\n      originalWidth,\n      originalHeight,\n      targetBitmapData,\n      width,\n      height,\n      modeNumber,\n      cppCallbackWrapper(this, cb)\n    );\n\n    return this;\n  } catch (err) {\n    return throwError.call(this, err, cb);\n  }\n}\n\nconst plugin: () => {\n  constants: Resize[\"constants\"];\n  class: PluginResize;\n} = () => ({\n  constants: {\n    RESIZE_NEAREST_NEIGHBOR: \"nearestNeighbor\",\n    RESIZE_BILINEAR: \"bilinearInterpolation\",\n    RESIZE_BICUBIC: \"bicubicInterpolation\",\n    RESIZE_HERMITE: \"hermiteInterpolation\",\n    RESIZE_BEZIER: \"bezierInterpolation\",\n  },\n  class: {\n    resize,\n    resizeAsync: wrapAsync(resize),\n  },\n});\n\nexport default plugin;\n"],"mappings":"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"}